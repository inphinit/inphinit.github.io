<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sendfile - Inphinit PHP</title>
  <meta name="description" content="Sendfile handles static files, allowing the use of authentication and other features, while the server takes care of delivering the content to the end user">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover">
  <link rel="stylesheet" type="text/css" href="/css/docs.1766454348.css" media="all">
  <link rel="alternate" href="/en/docs/production/sendfile.html" hreflang="en">
  <link rel="alternate" href="/pt/docs/production/sendfile.html" hreflang="pt">
  <script src="/js/docs.1766454348.js"></script>
</head>
<body>
  <div id="container">
    <main>
      <h1>Sendfile</h1>
      <p>
        <em>Sendfile</em> handles static files, allowing the use of authentication and other features, while the server takes care of delivering the content to the end user.
      </p>

      <section>
        <h2 id="modules">
          <a href="#modules">Modules</a>
        </h2>
        <div class="box">
          <table>
            <thead>
              <th>Module</th>
              <th>Web Server</th>
              <th>Website</th>
            </thead>
            <tbody>
              <tr>
                <td><code>X-Accel-Redirect</code></td>
                <td><a href="#nginx-module">nginx</a></td>
                <td>
                  X-Accel-Redirect is supported by default in <em>nginx</em>. <strong>Note:</strong> for security, configure a <code>location {}</code> with the <code>internal</code> directive.
                </td>
              </tr>
              <tr>
                <td><code>X-LIGHTTPD-send-file</code> & <code>X-Sendfile2</code></td>
                <td><a href="#lighttpd-module">Lighttpd module</a></td>
                <td>
                  <a rel="external nofollow noreferrer" target="_blank" href="https://redmine.lighttpd.net/projects/lighttpd/wiki/X-LIGHTTPD-send-file">
                    https://redmine.lighttpd.net/projects/lighttpd/wiki/X-LIGHTTPD-send-file
                  </a>
                </td>
              </tr>
              <tr>
                <td><code>X-Sendfile</code></td>
                <td><a href="#apache-module">Apache</a></td>
                <td>
                  <a rel="external nofollow noreferrer" target="_blank" href="https://tn123.org/mod_xsendfile/">
                    https://tn123.org/mod_xsendfile/
                  </a>
                </td>
              </tr>
              <tr>
                <td><code>Simulator</code></td>
                <td><a href="#simulator">Built-in Web Server</a></td>
                <td>
                  The built-in simulator in Inphinit applications allows you to partially simulate the X-Accel-Redirect and X-Sendfile headers in a simple way without needing a full server, making development easier.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section>
        <h2 id="nginx-module">
          <a href="#nginx-module">nginx module</a>
        </h2>

        <p>nginx compares this URI with its respective directories, as if it were a normal request. Then, it serves the directory that corresponds to the defined root and the URI passed in the header. Example configuration:</p>

        <div class="box">
          <code data-lang="conf">
          location / {
            ...

            location ~ \.php$ {
                # Replace by your FPM or FastCGI
                fastcgi_pass 127.0.0.1:9000;

                fastcgi_index index.php;
                include fastcgi_params;

                # It helps libraries detect if a resource is available
                fastcgi_param MOD_X_ACCEL_REDIRECT_ENABLED on;

                set $inphinit_prefix "";

                if ($uri != "/index.php") {
                    set $inphinit_prefix "/public";
                }

                fastcgi_param SCRIPT_FILENAME $realpath_root$inphinit_prefix$fastcgi_script_name;
            }
          }

          location /protected_files {
              root /path/foo/bar;
              internal;
          }
          </code>
        </div>

        <p>It is also possible to proxy to another server:</p>

        <div class="box">
          <code data-lang="conf">
          location /protected_files {
              proxy_pass http://127.0.0.2;
              internal;
          }
          </code>
        </div>

        <p>And in scripts you can use the header, as in the example:</p>

        <div class="box">
          <code data-lang="php">
          $app-&gt;action('GET', '/download', function () {
              if (isLoggedIn()) {
                  header("X-Accel-Redirect: /protected_files/sample.txt");
              }
          });
          </code>
        </div>

        <p>Using route pattern:</p>

        <div class="box">
          <code data-lang="php">
          $app-&gt;action('GET', '/download/&lt;file:alnum&gt;.txt', function (App $app, array $params) {
              if (isLoggedIn()) {
                  $name = $params['file']; // From &lt;file:alnum&gt;
                  header("X-Accel-Redirect: /protected_files/{$name}.txt");
              }
          });
          </code>
        </div>
      </section>

      <section>
        <h2 id="lighttpd-module">
          <a href="#lighttpd-module">Lighttpd module</a>
        </h2>

        <p>Example of how to enable it in lighttpd:</p>

        <div class="box">
          <code data-lang="conf">
          fastcgi.server = {
             ".php" =&gt; {
                "127.0.0.1" =&gt; {
                    # ....
                    "allow-x-send-file" =&gt; "enable" 
                }
             }
          }
          </code>
        </div>

        <p>Example of use:</p>

        <div class="box">
          <code data-lang="php">
          use Inphinit\Http\Response;

          $app-&gt;action('GET', '/download/&lt;file:alnum&gt;.txt', function (App $app, array $params) {
              if (isLoggedIn()) {
                  // Content-Disposition
                  Response::download('download.txt');

                  header('X-LIGHTTPD-send-file: /path/foo/bar/sample.txt');
              }
          });
          </code>
        </div>
      </section>

      <section>
        <h2 id="apache-module">
          <a href="#apache-module">Apache module</a>
        </h2>

        <p>To define the path it is necessary to modify server config, virtual host, directory contexts. Example:</p>

        <div class="box">
          <code data-lang="conf">
          &lt;VirtualHost ...&gt;
            ...
            XSendFilePath /path/foo/bar
          &lt;/VirtualHost&gt;
          </code>
        </div>

        <p>To enable it, you can do it in any context, including directly in the <code>.htaccess</code> file:</p>

        <div class="box">
          <code data-lang="conf">
          &lt;IfModule mod_negotiation.c&gt;
              Options -MultiViews
          &lt;/IfModule&gt;

          XSendFile on

          # It helps libraries detect if a resource is available
          SetEnv MOD_X_SENDFILE_ENABLED 1

          ...
          </code>
        </div>

        <p>Example of use:</p>

        <div class="box">
          <code data-lang="php">
          use Inphinit\Http\Response;

          $app-&gt;action('GET', '/download/&lt;file:alnum&gt;.txt', function (App $app, array $params) {
              if (isLoggedIn()) {
                  // Content-Disposition
                  Response::download('download.txt');

                  header('X-Sendfile: /path/foo/bar/sample.txt');
              }
          });
          </code>
        </div>
      </section>

      <section>
        <h2 id="simulator">
          <a href="#simulator">Simulator</a>
        </h2>

        <p>
          Using PHP's built-in web server, it's possible to simulate the <code>X-Accel-Redirect</code> and <code>X-Sendfile</code> headers. No configuration is necessary; simply use the headers. Then, when starting a local server, use <code>./run serve</code>, allowing the use of:
        </p>

        <div class="box">
          <code data-lang="php">
          $app-&gt;action('GET', '/download/&lt;file:alnum&gt;.txt', function (App $app, array $params) {
              if (isLoggedIn()) {
                  $name = $params['file'];
                  header("X-Accel-Redirect: /path/foo/bar/{$name}.txt");
              }
          });
          </code>
        </div>
      </section>

      <section>
        <h2 id="fileresponse-class">
          <a href="#fileresponse-class">FileResponse class</a>
        </h2>

        <aside class="info note">
          <svg viewBox="0 0 24 24" role="img">
            <path fill-rule="evenodd" clip-rule="evenodd" d="m10.051 15.75-.535-1.473-.328-.263a4.5 4.5 0 1 1 5.624 0l-.328.263-.535 1.473H10.05zM9 17.25h6l.75-2.066a6 6 0 1 0-7.5 0L9 17.25zm5.25 2.25V18h-4.5v1.5h4.5z"/>
          </svg>
          <p>
            <strong>Experimental:</strong> This is an experimental resource that is being considered for addition and may be subject to change or refactoring.
          </p>
        </aside>

        <p>
          The <code>Inphinit\Experimental\Http\FileResponse</code> class can also be used to serve files, relying on environment variables to verify module support. These variables typically must be configured manually.
        </p>

        <h3><code>FileResponse::ACCEL</code> (X-Accel-Redirect):</h3>

        <div class="box">
          <code data-lang="php">
          use Inphinit\Experimental\Http\FileResponse;

          $app-&gt;action('GET', '/download/&lt;file:alnum&gt;.txt', function (App $app, array $params) {
              if (isLoggedIn()) {
                  $handle = new FileResponse($params['file'], 'output.txt');

                  try {
                      // Try serving it with an X-Accel-Redirect header
                      $handle-&gt;send(FileResponse::ACCEL);
                  } catch (\Exception $ee) {
                      echo 'Downloads unavailable.';
                  }
              }
          });
          </code>
        </div>

        <h3><code>FileResponse::SENDFILE</code> (X-Sendfile):</h3>

        <div class="box">
          <code data-lang="php">
          $handle = new FileResponse($params['file'], 'output.txt');

          try {
              // Try serving it with an X-Sendfile header
              $handle-&gt;send(FileResponse::SENDFILE);
          } catch (\Exception $ee) {
              echo 'Downloads unavailable.';
          }
          </code>
        </div>

        <h3>Evaluating available modules:</h3>

        <div class="box">
          <code data-lang="php">
          $handle = new FileResponse($params['file'], 'output.txt');

          try {
              // It will try serving with X-Accel-Redirect if available, otherwise it will try using X-Sendfile
              $handle-&gt;send(FileResponse::ACCEL|FileResponse::SENDFILE);
          } catch (\Exception $ee) {
              echo 'Downloads unavailable.';
          }
          </code>
        </div>

        <h3>Fallback:</h3>

        <p>
          The <em>Senfile</em> fallback is an alternative mechanism that should be used only as a last resort and only when absolutely necessary. In the example below, the system first attempts to use <code>X-Accel-Redirect</code>; if that is unavailable, it falls back to <code>X-Sendfile</code> and if neither is supported, it ultimately serves the file directly via PHP:
        </p>

        <div class="box">
          <code data-lang="php">
          $handle = new FileResponse($params['file'], 'output.txt');

          try {
              $handle-&gt;send(FileResponse::ACCEL|FileResponse::SENDFILE|FileResponse::FALLBACK);
          } catch (\Exception $ee) {
              echo 'Downloads unavailable.';
          }
          </code>
        </div>
      </section>
    </main>

    <footer>
      <div>
        <p>Last updated on <time datetime="2025-12-22">Nov 22, 2025</time>.</p>
        <p>Content licensed under CC BY-SA.</p>
      </div>
      <div>
        <p>
          Site design by <a rel="external" target="_blank" href="https://github.com/brcontainer">Brcontainer</a>
        </p>
      </div>
    </footer>
  </div>

  <header>
    <a href="/">Go to homepage</a>
    <div>
      <!--
      <form method="get" id="search" action="http://duckduckgo.com/">
        <input type="hidden" name="sites" value="inphinit.github.io"/>
        <input type="hidden" name="k8" value="#444444"/>
        <input type="hidden" name="k9" value="#D51920"/>
        <input type="hidden" name="kt" value="h"/>
        <input type="text" name="q" maxlength="255" placeholder="Search&hellip;"/>
        <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
      </form>
      -->
      <a
        href="https://github.com/inphinit/inphinit"
        rel="external"
        target="_blank"
        aria-label="Access Github for get source">
        <svg
          fill="currentColor"
          viewBox="0 0 24 24"
          role="img"
          class="icon">
          <path d="M12 1.602c-6.077 0-11 4.818-11 10.766 0 4.763 3.149 8.787 7.521 10.213.55.095.756-.228.756-.51 0-.257-.013-1.104-.013-2.006-2.764.498-3.479-.66-3.699-1.265-.124-.31-.66-1.265-1.128-1.52-.385-.202-.935-.7-.013-.714.866-.013 1.485.78 1.691 1.104.99 1.628 2.571 1.17 3.204.888.096-.7.385-1.17.701-1.44-2.447-.27-5.005-1.198-5.005-5.316 0-1.17.426-2.14 1.128-2.893-.11-.269-.495-1.372.11-2.853 0 0 .92-.282 3.024 1.104.88-.242 1.816-.364 2.75-.364.936 0 1.87.122 2.75.364 2.104-1.4 3.025-1.104 3.025-1.104.605 1.48.22 2.584.11 2.853.702.754 1.128 1.71 1.128 2.893 0 4.132-2.571 5.047-5.019 5.316.399.336.743.982.743 1.992 0 1.44-.014 2.597-.014 2.96 0 .283.206.62.756.511a11.003 11.003 0 0 0 5.426-3.927A10.628 10.628 0 0 0 23 12.368C23 6.42 18.078 1.602 12 1.602z"/>
        </svg>
        <span class="compact">Star us on Github</span>
      </a>
      <div class="btn choose-options" id="color-scheme">
        <select aria-label="Color Scheme">
          <option value="auto">Auto</option>
          <option value="dark">Dark</option>
          <option value="light">Light</option>
        </select>
        <svg
          fill="currentColor"
          viewBox="0 0 24 24"
          role="img"
          class="icon">
          <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zm0-1.5v-17a8.5 8.5 0 1 1 0 17z"/>
        </svg>
      </div>

      <div class="btn choose-options" id="language-switcher">
        <select aria-label="Switch language">
          <option value="en">English</option>
          <option value="pt">PortuguÃªs</option>
        </select>
        <svg
          fill="none"
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          viewBox="0 0 24 24"
          class="icon">
          <path d="m5.636 8.364 5.455 5.454m-6.364 0 5.455-5.454L12 5.636m-9.09 0h10.908M7.455 2.91h.909M21.09 21.091 16.545 12 12 21.09m1.818-3.635h5.455"/>
        </svg>
      </div>
    </div>
  </header>

  <button id="menu-toggle" class="btn" aria-label="Display/Hide menu">
    <svg fill="currentColor" viewBox="0 0 24 24" role="img" class="icon">
      <path d="M21 6H3V5h18v1zm0 5H3v1h18v-1zm0 6H3v1h18v-1z"/>
    </svg>
    <!-- <svg fill="currentColor" viewBox="0 0 24 24" role="img" class="icon">
      <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
    </svg> -->
  </button>

  <nav id="menu" tabindex="-1">
  <div>
    <a href="/en/docs/">Get started</a>
    <dl>
      <dt>Web servers</dt>
      <!-- <dd><a href="/en/docs/web-servers/apache.html">Apache</a></dd> -->
      <dd><a href="/en/docs/web-servers/nginx.html">nginx</a></dd>
      <dd><a href="/en/docs/web-servers/iis.html">IIS</a></dd>
      <dd><a href="/en/docs/web-servers/iis-express.html">IIS Express</a></dd>
    </dl>
    <a href="/en/docs/structure.html">Structure</a>
    <a href="/en/docs/routing/">Routing</a>
    <dl>
      <dt>Routing features</dt>
      <dd><a href="/en/docs/routing/implicit-route-controllers.html">Implicit route controllers</a></dd>
      <dd><a href="/en/docs/routing/resource.html">Resource routes</a></dd>
    </dl>
    <a href="/en/docs/controllers.html">Controllers</a>
    <a href="/en/docs/views.html">Views</a>
    <a href="/en/docs/configurations.html">Configurations</a>
    <a href="/en/docs/debugging.html">Debugging</a>
    <a href="/en/docs/maintenance.html">Maintenance</a>
    <a href="/en/docs/error-pages.html">Error Pages</a>
    <a href="/en/docs/console-commands.html">Console Commands</a>
    <a href="/en/docs/events.html">Events</a>
    <a href="/en/docs/session.html">Session</a>
    <a href="/en/docs/checkup.html">Checkup</a>
    <a href="/en/docs/http/request.html">HTTP Request</a>
    <a href="/en/docs/http/response.html">HTTP Response</a>
    <dl>
      <dt>HTTP feautures</dt>
      <dd><a href="/en/docs/http/content-negotiation.html">Content Negotiation</a></dd>
      <dd><a href="/en/docs/http/response-codes.html">Response Codes</a></dd>
    </dl>
    <!-- <a href="/en/docs/storage-and-files.html">Storage and Files</a> -->
    <!-- <a href="/en/docs/cache.html">Cache</a> -->
    <a href="/en/docs/dom/">DOM, XML, HTML</a>
    <dl>
      <dt>DOM feautures</dt>
      <dd><a href="/en/docs/dom/css-selector.html">CSS Selector in PHP</a></dd>
      <dd><a href="/en/docs/dom/dom-with-arrays.html">DOM with Arrays</a></dd>
      <dd><a href="/en/docs/dom/errors.html">DOM Errors</a></dd>
    </dl>
    <a href="/en/docs/utilities/">Utilities</a>
    <dl>
      <dt>Specific utilities</dt>
      <dd><a href="/en/docs/utilities/url.html">Urls</a></dd>
      <dd><a href="/en/docs/utilities/version.html">Version</a></dd>
    </dl>
    <a href="/en/docs/experimental/">Experimental</a>
    <!-- <a href="/en/docs/performance.html">Performance</a> -->
    <dl>
      <dt>Production</dt>
      <!-- <dd><a href="/en/docs/production/forwarded.html">Forwarded</a></dd> -->
      <dd><a href="/en/docs/production/sendfile.html">Sendfile</a></dd>
    </dl>
    <dl>
      <dt>Packages</dt>
      <dd><a href="/en/docs/packages/inphinit-proxy.html">Inphinit Proxy</a></dd>
    </dl>
  </div>
  </nav>

  <div id="menu-backdrop"></div>
  <div class="grid-ani"></div>
</body>
</html>
